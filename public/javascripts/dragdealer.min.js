var Cursor={x:0,y:0,init:function(){this.setEvent("mouse");this.setEvent("touch")},setEvent:function(a){var b=document["on"+a+"move"]||function(){};document["on"+a+"move"]=function(a){b(a);Cursor.refresh(a)}},refresh:function(a){if(!a){a=window.event}if(a.type=="mousemove"){this.set(a)}else if(a.touches){this.set(a.touches[0])}},set:function(a){if(a.pageX||a.pageY){this.x=a.pageX;this.y=a.pageY}else if(a.clientX||a.clientY){this.x=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;this.y=a.clientY+document.body.scrollTop+document.documentElement.scrollTop}}};Cursor.init();var Position={get:function(a){var b=curtop=0;if(a.offsetParent){do{b+=a.offsetLeft;curtop+=a.offsetTop}while(a=a.offsetParent)}return[b,curtop]}};var Dragdealer=function(a,b){if(typeof a=="string"){a=document.getElementById(a)}if(!a){return}var c=a.getElementsByTagName("div")[0];if(!c||c.className.search(/(^|\s)handle(\s|$)/)==-1){return}this.init(a,c,b||{});this.setup()};Dragdealer.prototype={init:function(a,b,c){this.wrapper=a;this.handle=b;this.options=c;this.disabled=this.getOption("disabled",false);this.horizontal=this.getOption("horizontal",true);this.vertical=this.getOption("vertical",false);this.slide=this.getOption("slide",true);this.steps=this.getOption("steps",0);this.snap=this.getOption("snap",false);this.loose=this.getOption("loose",false);this.speed=this.getOption("speed",10)/100;this.xPrecision=this.getOption("xPrecision",0);this.yPrecision=this.getOption("yPrecision",0);this.callback=c.callback||null;this.animationCallback=c.animationCallback||null;this.bounds={left:c.left||0,right:-(c.right||0),top:c.top||0,bottom:-(c.bottom||0),x0:0,x1:0,xRange:0,y0:0,y1:0,yRange:0};this.value={prev:[-1,-1],current:[c.x||0,c.y||0],target:[c.x||0,c.y||0]};this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]};this.change=[0,0];this.activity=false;this.dragging=false;this.tapping=false},getOption:function(a,b){return this.options[a]!==undefined?this.options[a]:b},setup:function(){this.setWrapperOffset();this.setBoundsPadding();this.setBounds();this.setSteps();this.addListeners()},setWrapperOffset:function(){this.offset.wrapper=Position.get(this.wrapper)},setBoundsPadding:function(){if(!this.bounds.left&&!this.bounds.right){this.bounds.left=Position.get(this.handle)[0]-this.offset.wrapper[0];this.bounds.right=-this.bounds.left}if(!this.bounds.top&&!this.bounds.bottom){this.bounds.top=Position.get(this.handle)[1]-this.offset.wrapper[1];this.bounds.bottom=-this.bounds.top}},setBounds:function(){this.bounds.x0=this.bounds.left;this.bounds.x1=this.wrapper.offsetWidth+this.bounds.right;this.bounds.xRange=this.bounds.x1-this.bounds.x0-this.handle.offsetWidth;this.bounds.y0=this.bounds.top;this.bounds.y1=this.wrapper.offsetHeight+this.bounds.bottom;this.bounds.yRange=this.bounds.y1-this.bounds.y0-this.handle.offsetHeight;this.bounds.xStep=1/(this.xPrecision||Math.max(this.wrapper.offsetWidth,this.handle.offsetWidth));this.bounds.yStep=1/(this.yPrecision||Math.max(this.wrapper.offsetHeight,this.handle.offsetHeight))},setSteps:function(){if(this.steps>1){this.stepRatios=[];for(var a=0;a<=this.steps-1;a++){this.stepRatios[a]=a/(this.steps-1)}}},addListeners:function(){var a=this;this.wrapper.onselectstart=function(){return false};this.handle.onmousedown=this.handle.ontouchstart=function(b){a.handleDownHandler(b)};this.wrapper.onmousedown=this.wrapper.ontouchstart=function(b){a.wrapperDownHandler(b)};var b=document.onmouseup||function(){};document.onmouseup=function(c){b(c);a.documentUpHandler(c)};var c=document.ontouchend||function(){};document.ontouchend=function(b){c(b);a.documentUpHandler(b)};var d=window.onresize||function(){};window.onresize=function(b){d(b);a.documentResizeHandler(b)};this.wrapper.onmousemove=function(b){a.activity=true};this.wrapper.onclick=function(b){return!a.activity};this.interval=setInterval(function(){a.animate()},25);a.animate(false,true)},handleDownHandler:function(a){this.activity=false;Cursor.refresh(a);this.preventDefaults(a,true);this.startDrag();this.cancelEvent(a)},wrapperDownHandler:function(a){Cursor.refresh(a);this.preventDefaults(a,true);this.startTap()},documentUpHandler:function(a){this.stopDrag();this.stopTap()},documentResizeHandler:function(a){this.setWrapperOffset();this.setBounds();this.update()},enable:function(){this.disabled=false;this.handle.className=this.handle.className.replace(/\s?disabled/g,"")},disable:function(){this.disabled=true;this.handle.className+=" disabled"},setStep:function(a,b,c){this.setValue(this.steps&&a>1?(a-1)/(this.steps-1):0,this.steps&&b>1?(b-1)/(this.steps-1):0,c)},setValue:function(a,b,c){this.setTargetValue([a,b||0]);if(c){this.groupCopy(this.value.current,this.value.target)}},startTap:function(a){if(this.disabled){return}this.tapping=true;if(a===undefined){a=[Cursor.x-this.offset.wrapper[0]-this.handle.offsetWidth/2,Cursor.y-this.offset.wrapper[1]-this.handle.offsetHeight/2]}this.setTargetOffset(a)},stopTap:function(){if(this.disabled||!this.tapping){return}this.tapping=false;this.setTargetValue(this.value.current);this.result()},startDrag:function(){if(this.disabled){return}this.offset.mouse=[Cursor.x-Position.get(this.handle)[0],Cursor.y-Position.get(this.handle)[1]];this.dragging=true},stopDrag:function(){if(this.disabled||!this.dragging){return}this.dragging=false;var a=this.groupClone(this.value.current);if(this.slide){var b=this.change;a[0]+=b[0]*4;a[1]+=b[1]*4}this.setTargetValue(a);this.result()},feedback:function(){var a=this.value.current;if(this.snap&&this.steps>1){a=this.getClosestSteps(a)}if(!this.groupCompare(a,this.value.prev)){if(typeof this.animationCallback=="function"){this.animationCallback(a[0],a[1])}this.groupCopy(this.value.prev,a)}},result:function(){if(typeof this.callback=="function"){this.callback(this.value.target[0],this.value.target[1])}},animate:function(a,b){if(a&&!this.dragging){return}if(this.dragging){var c=this.groupClone(this.value.target);var d=[Cursor.x-this.offset.wrapper[0]-this.offset.mouse[0],Cursor.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetOffset(d,this.loose);this.change=[this.value.target[0]-c[0],this.value.target[1]-c[1]]}if(this.dragging||b){this.groupCopy(this.value.current,this.value.target)}if(this.dragging||this.glide()||b){this.update();this.feedback()}},glide:function(){var a=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];if(!a[0]&&!a[1]){return false}if(Math.abs(a[0])>this.bounds.xStep||Math.abs(a[1])>this.bounds.yStep){this.value.current[0]+=a[0]*this.speed;this.value.current[1]+=a[1]*this.speed}else{this.groupCopy(this.value.current,this.value.target)}return true},update:function(){if(!this.snap){this.offset.current=this.getOffsetsByRatios(this.value.current)}else{this.offset.current=this.getOffsetsByRatios(this.getClosestSteps(this.value.current))}this.show()},show:function(){if(!this.groupCompare(this.offset.current,this.offset.prev)){if(this.horizontal){this.handle.style.left=String(this.offset.current[0])+"px"}if(this.vertical){this.handle.style.top=String(this.offset.current[1])+"px"}this.groupCopy(this.offset.prev,this.offset.current)}},setTargetValue:function(a,b){var c=b?this.getLooseValue(a):this.getProperValue(a);this.groupCopy(this.value.target,c);this.offset.target=this.getOffsetsByRatios(c)},setTargetOffset:function(a,b){var c=this.getRatiosByOffsets(a);var d=b?this.getLooseValue(c):this.getProperValue(c);this.groupCopy(this.value.target,d);this.offset.target=this.getOffsetsByRatios(d)},getLooseValue:function(a){var b=this.getProperValue(a);return[b[0]+(a[0]-b[0])/4,b[1]+(a[1]-b[1])/4]},getProperValue:function(a){var b=this.groupClone(a);b[0]=Math.max(b[0],0);b[1]=Math.max(b[1],0);b[0]=Math.min(b[0],1);b[1]=Math.min(b[1],1);if(!this.dragging&&!this.tapping||this.snap){if(this.steps>1){b=this.getClosestSteps(b)}}return b},getRatiosByOffsets:function(a){return[this.getRatioByOffset(a[0],this.bounds.xRange,this.bounds.x0),this.getRatioByOffset(a[1],this.bounds.yRange,this.bounds.y0)]},getRatioByOffset:function(a,b,c){return b?(a-c)/b:0},getOffsetsByRatios:function(a){return[this.getOffsetByRatio(a[0],this.bounds.xRange,this.bounds.x0),this.getOffsetByRatio(a[1],this.bounds.yRange,this.bounds.y0)]},getOffsetByRatio:function(a,b,c){return Math.round(a*b)+c},getClosestSteps:function(a){return[this.getClosestStep(a[0]),this.getClosestStep(a[1])]},getClosestStep:function(a){var b=0;var c=1;for(var d=0;d<=this.steps-1;d++){if(Math.abs(this.stepRatios[d]-a)<c){c=Math.abs(this.stepRatios[d]-a);b=d}}return this.stepRatios[b]},groupCompare:function(a,b){return a[0]==b[0]&&a[1]==b[1]},groupCopy:function(a,b){a[0]=b[0];a[1]=b[1]},groupClone:function(a){return[a[0],a[1]]},preventDefaults:function(a,b){if(!a){a=window.event}if(a.preventDefault){a.preventDefault()}a.returnValue=false;if(b&&document.selection){document.selection.empty()}},cancelEvent:function(a){if(!a){a=window.event}if(a.stopPropagation){a.stopPropagation()}a.cancelBubble=true}}
